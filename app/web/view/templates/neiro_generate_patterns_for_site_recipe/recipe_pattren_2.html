<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ recipe_data.name }}</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: {{ bg_color|default('#f0f0f0') }};
            font-family: 'Arial', sans-serif;
            overflow: hidden;
        }

        .star-container {
            position: relative;
            width: 1000px;
            height: 1000px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .central-space {
            position: absolute;
            width: 500px;
            height: 500px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
            padding: 20px;
            box-sizing: border-box;
        }

        .recipe-title {
            font-size: 32px;
            font-weight: bold;
            color: #545B81;
            margin-bottom: 20px;
            text-align: center;
        }

        .recipe-description {
            font-size: 16px;
            color: #686F95;
            text-align: center;
            max-width: 80%;
        }

        .square {
            position: absolute;
            border-radius: 5px;
            opacity: 0.8;
            animation: pulse 4s infinite ease-in-out;
            transition: all 0.5s ease;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        .color-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .color-btn {
            padding: 8px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="star-container" id="starContainer">
        <!-- Central space for recipe -->
        <div class="central-space">
            <h1 class="recipe-title">{{ recipe_data.name }}</h1>
            <p class="recipe-description">{{ recipe_data.content.theme }}</p>
        </div>

        <!-- Squares will be generated here by JavaScript -->
    </div>

    <div class="color-controls">
        <button class="color-btn" style="background: #545B81; color: white;" onclick="changeColorScheme('#545B81', '#686F95', '#8F94B4')">Основная</button>
        <button class="color-btn" style="background: #5B8154; color: white;" onclick="changeColorScheme('#5B8154', '#6F9568', '#94B48F')">Зеленая</button>
        <button class="color-btn" style="background: #815454; color: white;" onclick="changeColorScheme('#815454', '#956868', '#B48F94')">Красная</button>
        <button class="color-btn" style="background: #2D3250; color: white;" onclick="changeColorScheme('#2D3250', '#3D4468', '#5A618F')">Темная</button>
    </div>

    <script>
        // Color palette
        const colorSchemes = {
            default: {
                primary: '#545B81',
                secondary: '#686F95',
                accent: '#8F94B4'
            },
            green: {
                primary: '#5B8154',
                secondary: '#6F9568',
                accent: '#94B48F'
            },
            red: {
                primary: '#815454',
                secondary: '#956868',
                accent: '#B48F94'
            },
            dark: {
                primary: '#2D3250',
                secondary: '#3D4468',
                accent: '#5A618F'
            }
        };

        // Current colors
        let currentColors = {...colorSchemes.default};

        // Generate star squares
        function generateStar() {
            const container = document.getElementById('starContainer');
            container.innerHTML = '';

            // Add central space back
            const centralSpace = document.createElement('div');
            centralSpace.className = 'central-space';
            centralSpace.innerHTML = `
                <h1 class="recipe-title">{{ recipe_data.name }}</h1>
                <p class="recipe-description">{{ recipe_data.content.theme }}</p>
            `;
            container.appendChild(centralSpace);

            // Square sizes and counts
            const sizes = [
                { size: 350, count: 5 },
                { size: 300, count: 8 },
                { size: 100, count: 10 },
                { size: 50, count: 15 },
                { size: 30, count: 22 }
            ];

            let totalSquares = 0;

            // Generate squares for each size
            sizes.forEach(group => {
                for (let i = 0; i < group.count; i++) {
                    createSquare(group.size, totalSquares + i);
                }
                totalSquares += group.count;
            });
        }

        // Create a single square
        function createSquare(size, index) {
            const container = document.getElementById('starContainer');
            const square = document.createElement('div');
            square.className = 'square';

            // Position in star pattern (4-pointed star)
            const angle = (index % 4) * Math.PI / 2;
            const distance = 200 + (size / 2) + (index % 3) * 50;

            // Calculate position
            const centerX = 500;
            const centerY = 500;
            const x = centerX + Math.cos(angle) * distance - size/2;
            const y = centerY + Math.sin(angle) * distance - size/2;

            // Random variation for more organic look
            const variationX = (Math.random() - 0.5) * 50;
            const variationY = (Math.random() - 0.5) * 50;

            // Set square styles
            square.style.width = `${size}px`;
            square.style.height = `${size}px`;
            square.style.left = `${x + variationX}px`;
            square.style.top = `${y + variationY}px`;

            // Color selection with smooth transitions
            const colorIndex = Math.floor(index / 4) % 3;
            let color;
            if (colorIndex === 0) color = currentColors.primary;
            else if (colorIndex === 1) color = currentColors.secondary;
            else color = currentColors.accent;

            square.style.backgroundColor = color;

            // Animation delay for wave effect
            square.style.animationDelay = `${(index % 8) * 0.5}s`;

            container.appendChild(square);
        }

        // Change color scheme
        function changeColorScheme(primary, secondary, accent) {
            currentColors = { primary, secondary, accent };

            // Update all squares
            const squares = document.querySelectorAll('.square');
            squares.forEach((square, index) => {
                const colorIndex = Math.floor(index / 4) % 3;
                let color;
                if (colorIndex === 0) color = primary;
                else if (colorIndex === 1) color = secondary;
                else color = accent;

                square.style.backgroundColor = color;
            });
        }

        // Change background color
        function changeBackgroundColor(color) {
            document.body.style.backgroundColor = color;
        }

        // Initialize
        window.onload = function() {
            generateStar();

            // Add background color buttons
            const bgColors = ['#f0f0f0', '#e8f4f8', '#f8f8f0', '#2a2a2a'];
            const colorControls = document.querySelector('.color-controls');

            bgColors.forEach(color => {
                const btn = document.createElement('button');
                btn.className = 'color-btn';
                btn.style.backgroundColor = color;
                btn.style.border = '1px solid #ccc';
                btn.innerHTML = '&nbsp;';
                btn.onclick = () => changeBackgroundColor(color);
                colorControls.appendChild(btn);
            });
        };
    </script>
</body>
</html>